Border Gateway Protocol [BGP]

- The purpose of BGP is to connect 2 AS's to each other.
- It is generally run on the Edge Routers.
- BGP sets up relationship's with neighbors based on Unicast.
- There are 2 main advantages of BGP
  - Scalability
  - Gives you a lot of control to choose the best route

Configuring BGP between 2 AS's.

R1:

router bgp 1000
 network 1.0.0.0 mask 255.0.0.0
 neighbor 192.1.14.4 remote-as 400

Injecting Routes into BGP

Major netwokrs

router bgp 1000
 network 1.0.0.0

Subnets

router bgp 1000
 network 11.11.11.0 mask 255.255.255.0

Inject a route into BGP without using the Network Statement
205.1.4.0/24, 205.1.5.0/24, 205.1.6.0/24, 205.1.7.0/24

route-map RC
 match interface lo201 lo202 lo203 lo204
 set origin igp

router bgp 500
 redistributed connected route-map RC
 
-------------------------------------------------------------------
IBGP Configuration
1. Configure a Loopback on the Router and Advertise it in the IGP

R1
interface lo10 
 ip address 10.1.1.1 255.255.255.0
!
router eigrp 100
 no auto
 network 192.1.12.0
 network 192.1.13.0
 network 10.0.0.0

2. Configure the iBGP Neighbor Relationship based on the Loopback

R1
router bgp 1000
 neighbor 10.2.2.2 remote-as 1000
 neighbor 10.2.2.2 update-source lo10
 neighbor 10.2.2.2 next-hop-self

R3:
router bgp 1000
 neighbor 10.2.2.2 remote-as 1000
 neighbor 10.2.2.2 update-source lo10
 neighbor 10.1.1.1 next-hop-self

R2:
router bgp 1000
 neighbor ABC peer-group
 neighbor ABC remote-as 1000
 neighbor ABC update-source lo10
 neighbor ABC next-hop-self
 neighbor ABC route-reflector-client
 neighbor 10.1.1.1 peer-group ABC
 neighbor 10.3.3.3 peer-group ABC

---------------------
Authentication
R1
router bgp 1000
 neighbor 192.1.14.4 password cisco123

R4

router bgp 400
 neighbor 192.1.14.1 password cisco123

--------------------
Filtering using the Neighbor command - ACL

R1
access-list 1 deny 11.11.11.0 0.0.0.255
access-list 1 permit any
!
router bgp 1000
 neighbor 192.1.14.4 distribute-list 1 out

or 
R4
access-list 1 deny 11.11.11.0 0.0.0.255
access-list 1 permit any
!
router bgp 400
 neighbor 192.1.14.1 distribute-list 1 in

----------
R1
ip prefix-list ABC deny 111.111.111.0/24
ip prefix-list ABC permit 0.0.0.0/0 le 32
!
router bgp 1000
 neighbor 192.1.17.7 prefix-list ABC out

or
R7
ip prefix-list ABC deny 111.111.111.0/24
ip prefix-list ABC permit 0.0.0.0/0 le 32
!
router bgp 700
 neighbor 192.1.17.1 prefix-list ABC in


### COMMAND ###
do clear ip bgp * soft
==================================================================================
Aggregation / Summarization

R1
interface lo201
 ip address 201.1.4.1 255.255.255.0
interface lo202
 ip address 201.1.5.1 255.255.255.0
interface lo203
 ip address 201.1.6.1 255.255.255.0
interface lo204
 ip address 201.1.7.1 255.255.255.0
!
router bgp 1000
 network 201.1.4.0
 network 201.1.5.0
 network 201.1.6.0
 network 201.1.7.0
 
R2
interface lo201
 ip address 202.1.4.1 255.255.255.0
interface lo202
 ip address 202.1.5.1 255.255.255.0
interface lo203
 ip address 202.1.6.1 255.255.255.0
interface lo204
 ip address 202.1.7.1 255.255.255.0
!
router bgp 1000
 network 202.1.4.0
 network 202.1.5.0
 network 202.1.6.0
 network 202.1.7.0
-----------------------
Aggreagation with Filtering

I want to create the Summary route on R1. Only send the Summary-route to the eBGP neighbors. Only send the specific
routes to the iBGP neighbors.


1. Create the Summary Route without blocking the specifics.
R1
router bgp 1000
 aggregate-address 201.1.4.0 255.255.252.0

2. Filter the specifics from getting sent outside the AS.

R1
ip prefix-list SUMM-OUT deny 201.1.4.0/22 ge 24
ip prefix-list SUMM-OUT permit 0.0.0.0/0 le 32
!
ip prefix-list SPEC-OUT deny 201.1.4.0/22 eq 22
ip prefix-list SPEC-OUT permit 0.0.0.0/0 le 32
router bgp 1000
 neighbor 192.1.14.4 prefix-list SUMM-OUT out
 neighbor 192.1.17.7 prefix-list SUMM-OUT out
 neighbor 10.2.2.2 prefix-list SPEC-OUT out

R3
ip prefix-list SUMM-OUT deny 201.1.4.0/22 ge 24
ip prefix-list SUMM-OUT permit 0.0.0.0/0 le 32
!
router bgp 1000
 neighbor 192.1.36.6 prefix-list SUMM-OUT out
 neighbor 192.1.37.7 prefix-list SUMM-OUT out
--------------------
Aggregation with automatic blocking of specifics [Just like IGP does it]

R2
router bgp 1000
 aggregate-address 201.1.4.0 255.255.252.0 summary-only

It means that the specific routes that fall under the summary should be suppressed.

CONTINUE AT 2:34:00
 